<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="    viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <title>Sign up</title>
    <style>
        body{
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            width: 100vw;
            margin: 0px;

        }
        img{
    height: 150px;
    width: 300px;
}

.social-container {
	margin: 15px 0;
    text-align: center;
}

.social-container a {
    padding: 10px;
    text-align: center;
    text-decoration: none;
    margin: 5px 2px;
    border-radius: 50%;
	display: inline-flex;
	justify-content: center;
	margin: 0 5px;
	height: 40px;
	width: 40px;
    font-size: 25px;
}
.fa-facebook {
    background: #3B5998;
    color: white;
  }
  .fa-twitter {
    background: #55ACEE;
    color: white;
  }
  
  .fa-google {
    background: #dd4b39;
    color: white;
  }
  
  .fa-linkedin {
    background: #007bb5;
    color: white;
  }
    </style>
</head>
<body>
    <div class="mb-5">
        <img src="https://1000logos.net/wp-content/uploads/2021/05/Meetup-logo.png">
        <input type="text" placeholder="Enter Username" id="userInp" class="form-control mb-3">
        <input type="text" placeholder="Enter Password" id="passInp" class="form-control mb-3"/>
       <div class="form-check form-switch">
            <input class="form-check-input" type="checkbox" id="customSwitch1">
            <label class="form-check-label" for="customSwitch1">Keep me Login</label>
          </div>
          <br>
        <button type="text" id="sub_btn" class="btn w-100 btn-outline-primary mb-3">Sign in</button>
        <a href="signup.html" class="badge-secondary">Create an Account</a>
        <div class="social-container ">
            <a href="#" class="fa fa-facebook"></a>
            <a href="#" class="fa fa-twitter"></a>
            <a href="#" class="fa fa-google"></a>
            <a href="#" class="fa fa-linkedin"></a>
        </div>  
    </div>

</body>
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.18.0/firebase-app.js";
    import { getDatabase , ref , set , child , get } from "https://www.gstatic.com/firebasejs/9.18.0/firebase-database.js";
    const firebaseConfig = {
    apiKey: "AIzaSyCuHrtSAPLC6CQeuv9WkaWcjksWFWly6TY",
    authDomain: "meetup-5ffb3.firebaseapp.com",
    databaseURL: "https://meetup-5ffb3-default-rtdb.firebaseio.com",
    projectId: "meetup-5ffb3",
    storageBucket: "meetup-5ffb3.appspot.com",
    messagingSenderId: "180793006827",
    appId: "1:180793006827:web:7665f36e7487bcf42e3cae"
  };
  
    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getDatabase();
    //...........................................The Refrences.......................//

    const username = document.getElementById('userInp');
    const pass = document.getElementById('passInp');
    const submit = document.getElementById('sub_btn');
    //..................................Authentication...............................//
    function AuthenticateUser(){
        const dbref =ref(db);
        
    get(child(dbref,"userList/"+ username.value)).then((snapshot)=>{
            if(snapshot.exists()){
               let dbpass = decPass(snapshot.val().password);
               if(dbpass == pass.value){
                login(snapshot.val());
                alert("Welcome "+username.value+"!");
               }
               else{
                alert("User does not exist!");
               }
            }
            else{
                alert("Username or Password is Invalid");
            }
           
        });
    

    }
   //.................................Decryption.......................//
   function decPass(dbpass){
        var pass12 = CryptoJS.AES.decrypt(dbpass, pass.value);
        return pass12.toString(CryptoJS.enc.Utf8);
    }
    //..................................Login..........................//
    function login(user){
        let keepLoggedIn = document.getElementById('customSwitch1').checked;
        if(!keepLoggedIn){
            sessionStorage.setItem('user',JSON.stringify(user));
            window.location = "index.html";
        }
        else{
            localStorage.setItem('keepLoggedIn','yes');
            localStorage.setItem('user',JSON.stringify(user));
            window.location="index.html";
        }
    }
    submit.addEventListener('click', AuthenticateUser);
  </script>
</html>